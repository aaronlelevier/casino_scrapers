<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>location.models &mdash; BSRS 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="BSRS 1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for location.models</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">python_2_unicode_compatible</span>

<span class="kn">from</span> <span class="nn">util.models</span> <span class="kn">import</span> <span class="n">AbstractName</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">BaseManager</span>


<span class="c">### SUPPORT MODELS</span>

<div class="viewcode-block" id="State"><a class="viewcode-back" href="../../modules/models.html#location.models.State">[docs]</a><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">AbstractName</span><span class="p">):</span>
    <span class="n">abbr</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s">&#39;abbr&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">abbr</span>
        <span class="p">}</span>
</div>
<div class="viewcode-block" id="Country"><a class="viewcode-back" href="../../modules/models.html#location.models.Country">[docs]</a><span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">AbstractName</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Countries&#39;</span>


<span class="c">### SELF REFERENCING BASE</span>
</div>
<div class="viewcode-block" id="SelfRefrencingQuerySet"><a class="viewcode-back" href="../../modules/models.html#location.models.SelfRefrencingQuerySet">[docs]</a><span class="k">class</span> <span class="nc">SelfRefrencingQuerySet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>
    <span class="s">&quot;Query Parent / Child relationships for all SelfRefrencing Objects.&quot;</span>

<div class="viewcode-block" id="SelfRefrencingQuerySet.get_all_children"><a class="viewcode-back" href="../../modules/models.html#location.models.SelfRefrencingQuerySet.get_all_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">all_children</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return all Child Objects regardless of distance in the Tree.</span>

<span class="sd">        :parent: Getting all children for this Object.</span>

<span class="sd">        :all_children: default to None always until recursively called</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_children</span><span class="p">:</span>
            <span class="n">all_children</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">new_children</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">new_children</span> <span class="o">-</span> <span class="n">all_children</span><span class="p">:</span>
            <span class="n">all_children</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_children</span><span class="p">)</span>
            <span class="c"># for each child, call the function in a tree</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_children</span><span class="p">:</span>
                <span class="n">ea</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="n">all_children</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">all_children</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SelfRefrencingQuerySet.get_all_parents"><a class="viewcode-back" href="../../modules/models.html#location.models.SelfRefrencingQuerySet.get_all_parents">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">first_child_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">all_parents</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return all Parent Objects regardless of distance in the Tree.</span>

<span class="sd">        :child: getting all parents for this Object</span>

<span class="sd">        :first_child_id: </span>
<span class="sd">            the ``child_id`` that we are looking up all parents for,</span>
<span class="sd">            and will be excluded from the output</span>

<span class="sd">        :all_parents: default to None always until recursively called</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">first_child_id</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_parents</span><span class="p">:</span>
            <span class="n">all_parents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c"># filter for ``parents`` where this is their ``child``</span>
        <span class="n">new_parents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">new_parents</span> <span class="o">-</span> <span class="n">all_parents</span><span class="p">:</span>
            <span class="n">all_parents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_parents</span><span class="p">)</span>
            <span class="c"># for each child, call the function in a tree</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_parents</span><span class="p">:</span>
                <span class="n">ea</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_all_parents</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="n">first_child_id</span><span class="p">,</span> <span class="n">all_parents</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">all_parents</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">first_child_id</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SelfRefrencingManager"><a class="viewcode-back" href="../../modules/models.html#location.models.SelfRefrencingManager">[docs]</a><span class="k">class</span> <span class="nc">SelfRefrencingManager</span><span class="p">(</span><span class="n">BaseManager</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SelfRefrencingQuerySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">deleted__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_all_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">all_children</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">all_children</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">first_child_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">all_parents</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">get_all_parents</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">first_child_id</span><span class="p">,</span> <span class="n">all_parents</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">d3_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output the Models&#39; self referencing structure to JSON for d3js. Note: &quot;type&quot;: &quot;suite&quot; </span>
<span class="sd">        is a default argument for the code, but can be used to change the colors of the arrows.</span>

<span class="sd">        `d3js reference &lt;http://bl.ocks.org/mbostock/1153292#index.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;source&quot;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;target&quot;</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;suit&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SelfRefrencingBaseModel"><a class="viewcode-back" href="../../modules/models.html#location.models.SelfRefrencingBaseModel">[docs]</a><span class="k">class</span> <span class="nc">SelfRefrencingBaseModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    ``symmetrical = false``: to indicate one way relationship</span>

<span class="sd">    `Symetrical Documentation Here &lt;https://docs.djangoproject.com/en/1.8/ref/models/fields/</span>
<span class="sd">    #django.db.models.ManyToManyField.symmetrical&gt;`_</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">symmetrical</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;parents&#39;</span><span class="p">)</span>

    <span class="c"># Manager</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">SelfRefrencingManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>


<span class="c">### LOCATION LEVEL</span>
</div>
<div class="viewcode-block" id="LocationLevel"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationLevel">[docs]</a><span class="k">class</span> <span class="nc">LocationLevel</span><span class="p">(</span><span class="n">SelfRefrencingBaseModel</span><span class="p">,</span> <span class="n">AbstractName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    LocationLevel records must be unique by: name, role_type</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
    

<span class="c">### LOCATION STATUS</span>
</div>
<div class="viewcode-block" id="LocationStatusManager"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationStatusManager">[docs]</a><span class="k">class</span> <span class="nc">LocationStatusManager</span><span class="p">(</span><span class="n">BaseManager</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return the **default** status for the initial Location </span>
<span class="sd">    ``.create()`` if one isn&#39;t specified.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_LOCATION_STATUS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

</div>
<div class="viewcode-block" id="LocationStatus"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationStatus">[docs]</a><span class="k">class</span> <span class="nc">LocationStatus</span><span class="p">(</span><span class="n">AbstractName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tells whether the store is: *Open, Closed, Future, etc...*</span>

<span class="sd">    Single *name* field, with more configuration on this </span>
<span class="sd">    model planned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">objects</span> <span class="o">=</span> <span class="n">LocationStatusManager</span><span class="p">()</span>


<span class="c">### LOCATION TYPE</span>
</div>
<div class="viewcode-block" id="LocationTypeManager"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationTypeManager">[docs]</a><span class="k">class</span> <span class="nc">LocationTypeManager</span><span class="p">(</span><span class="n">BaseManager</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_LOCATION_TYPE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

</div>
<div class="viewcode-block" id="LocationType"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationType">[docs]</a><span class="k">class</span> <span class="nc">LocationType</span><span class="p">(</span><span class="n">AbstractName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; &#39;&#39;&#39;</span>
    
    <span class="n">objects</span> <span class="o">=</span> <span class="n">LocationTypeManager</span><span class="p">()</span>


<span class="c">### LOCATION</span>
</div>
<div class="viewcode-block" id="LocationQuerySet"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationQuerySet">[docs]</a><span class="k">class</span> <span class="nc">LocationQuerySet</span><span class="p">(</span><span class="n">SelfRefrencingQuerySet</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; &#39;&#39;&#39;</span>

<div class="viewcode-block" id="LocationQuerySet.get_level_children"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationQuerySet.get_level_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_level_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Includes error handling that the level_id is valid.</span>

<span class="sd">        :location: Parent ``Location``</span>
<span class="sd">        :level_id: </span>
<span class="sd">            ``LocationLevel.id`` of the ``Child Locations`` </span>
<span class="sd">            to return.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">child_levels</span> <span class="o">=</span> <span class="n">LocationLevel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_all_children</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">location_level</span><span class="p">)</span>
            <span class="n">location_level</span> <span class="o">=</span> <span class="n">LocationLevel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">id__in</span><span class="o">=</span><span class="n">child_levels</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">level_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">location_level</span><span class="o">=</span><span class="n">location_level</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LocationQuerySet.get_level_parents"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationQuerySet.get_level_parents">[docs]</a>    <span class="k">def</span> <span class="nf">get_level_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Includes error handling that the level_id is valid.</span>
<span class="sd">        </span>
<span class="sd">        :location: Child ``Location``</span>
<span class="sd">        :level_id: </span>
<span class="sd">            ``LocationLevel.id`` of the ``Parent Locations`` </span>
<span class="sd">            to return.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parent_levels</span> <span class="o">=</span> <span class="n">LocationLevel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_all_parents</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">location_level</span><span class="p">)</span>
            <span class="n">location_level</span> <span class="o">=</span> <span class="n">LocationLevel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">id__in</span><span class="o">=</span><span class="n">parent_levels</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">level_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">location_level</span><span class="o">=</span><span class="n">location_level</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="LocationManager"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationManager">[docs]</a><span class="k">class</span> <span class="nc">LocationManager</span><span class="p">(</span><span class="n">SelfRefrencingManager</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LocationQuerySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">deleted__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
<div class="viewcode-block" id="LocationManager.get_level_children"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationManager.get_level_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_level_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all child Locations at a specific LocationLevel.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">get_level_children</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LocationManager.get_level_parents"><a class="viewcode-back" href="../../modules/models.html#location.models.LocationManager.get_level_parents">[docs]</a>    <span class="k">def</span> <span class="nf">get_level_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all Parent Locations at a specific LocationLevel.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">get_level_parents</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">level_id</span><span class="p">)</span>

</div></div>
<span class="nd">@python_2_unicode_compatible</span>
<div class="viewcode-block" id="Location"><a class="viewcode-back" href="../../modules/models.html#location.models.Location">[docs]</a><span class="k">class</span> <span class="nc">Location</span><span class="p">(</span><span class="n">SelfRefrencingBaseModel</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Physical Store ``Locations`` that have a ``LocationLevel``.</span>

<span class="sd">    :ex:</span>
<span class="sd">        At the *Region* ``LocationLevel`` there is a </span>
<span class="sd">        *East* ``Location``.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># keys</span>
    <span class="n">location_level</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">LocationLevel</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;locations&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">LocationStatus</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;locations&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s">&quot;If not provided, will be the default &#39;LocationStatus&#39;.&quot;</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">LocationType</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;locations&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># fields</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">LocationManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">LocationStatus</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">LocationType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Aaron, Scott, Andy, Tom, Toran.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>